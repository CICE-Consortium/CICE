

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. Troubleshooting &#8212; CICE-Consortium 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Acknowledgments and Copyright" href="cice_6_copyright.html" />
    <link rel="prev" title="4. Numerical implementation" href="cice_4_numerical_implementation.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cice_6_copyright.html" title="6. Acknowledgments and Copyright"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="cice_4_numerical_implementation.html" title="4. Numerical implementation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Troubleshooting</a><ul>
<li><a class="reference internal" href="#initial-setup">5.1. Initial setup</a></li>
<li><a class="reference internal" href="#restarts">5.2. Restarts</a></li>
<li><a class="reference internal" href="#slow-execution">5.3. Slow execution</a></li>
<li><a class="reference internal" href="#debugging-hints">5.4. Debugging hints</a></li>
<li><a class="reference internal" href="#known-bugs">5.5. Known bugs</a></li>
<li><a class="reference internal" href="#interpretation-of-albedos">5.6. Interpretation of albedos</a></li>
<li><a class="reference internal" href="#proliferating-subprocess-parameterizations">5.7. Proliferating subprocess parameterizations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cice_4_numerical_implementation.html"
                        title="previous chapter">4. Numerical implementation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cice_6_copyright.html"
                        title="next chapter">6. Acknowledgments and Copyright</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cice_5_troubleshooting.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="troubleshooting">
<h1>5. Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>Check the FAQ: <a class="reference external" href="http://oceans11.lanl.gov/drupal/CICE/FAQ">http://oceans11.lanl.gov/drupal/CICE/FAQ</a>.</p>
<div class="section" id="initial-setup">
<span id="setup"></span><h2>5.1. Initial setup<a class="headerlink" href="#initial-setup" title="Permalink to this headline">¶</a></h2>
<p>The script <strong>comp_ice</strong> is configured so that the files <strong>grid</strong>,
<strong>kmt</strong>, <strong>ice_in</strong>, <strong>run_ice</strong>, <strong>iced_gx3_v5.0</strong> and
<strong>ice.restart_file</strong> are NOT overwritten after the first setup. If you
wish to make changes to the original files in <strong>input_templates/</strong>
rather than those in the run directory, either remove the files from the
run directory before executing <strong>comp_ice</strong> or edit the script.</p>
<p>The code may abort during the setup phase for any number of reasons, and
often the buffer containing the diagnostic output fails to print before
the executable exits. The quickest way to get the diagnostic information
is to run the code in an interactive shell with just the command <cite>cice</cite>
for serial runs or “<cite>mpirun -np N cice</cite>” for MPI runs, where N is the
appropriate number of processors (or a command appropriate for your
computer’s software).</p>
<p>If the code fails to compile or run, or if the model configuration is
changed, try the following:</p>
<ul class="simple">
<li>create <strong>Macros.*</strong>. <strong>Makefile.*</strong> and <strong>run_ice.*</strong> files for
your particular platform, if they do not already exist (type ‘uname
-s’ at the prompt and compare the result with the file suffixes; we
rename <cite>UNICOS/mp</cite> as <cite>UNICOS</cite> for simplicity).</li>
<li>modify the <cite>INCLUDE</cite> directory path and other settings for your system
in the scripts, <strong>Macros.*</strong> and <strong>Makefile.*</strong> files.</li>
<li>alter directory paths, file names and the execution command as needed
in <strong>run_ice</strong> and <strong>ice_in</strong>.</li>
<li>ensure that <cite>nprocs</cite> in <strong>ice_in</strong> is equal to <cite>NTASK</cite> in <strong>comp_ice</strong>.</li>
<li>ensure that the block size <cite>NXBLOCK</cite>, <cite>NYBLOCK</cite> in <strong>comp_ice</strong> is
compatible with the processor_shape and other domain options in
<strong>ice_in</strong></li>
<li>if using the rake or space-filling curve algorithms for block
distribution (<cite>distribution_type</cite> in <strong>ice_in</strong>) the code will abort
if <cite>MXBLCKS</cite> is not large enough. The correct value is provided in the
diagnostic output.</li>
<li>if starting from a restart file, ensure that kcatbound is the same as
that used to create the file (<cite>kcatbound</cite> = 0 for the files included in
this code distribution). Other configuration parameters, such as
<cite>NICELYR</cite>, must also be consistent between runs.</li>
<li>for stand-alone runs, check that <cite>-Dcoupled</cite> is <em>not</em> set in the
<strong>Macros.*</strong> file.</li>
<li>for coupled runs, check that <cite>-Dcoupled</cite> and other
coupled-model-specific (e.g., CESM, popcice or hadgem) preprocessing
options are set in the <strong>Macros.*</strong> file.</li>
<li>edit the grid size and other parameters in <strong>comp_ice</strong>.</li>
<li>remove the <strong>compile/</strong> directory completely and recompile.</li>
</ul>
</div>
<div class="section" id="restarts">
<span id="restarttrouble"></span><h2>5.2. Restarts<a class="headerlink" href="#restarts" title="Permalink to this headline">¶</a></h2>
<p>CICE version 5 introduces a new model configuration that makes
restarting from older simulations difficult. In particular, the number
of ice categories, the category boundaries, and the number of vertical
layers within each category must be the same in the restart file and in
the run restarting from that file. Moreover, significant differences in
the physics, such as the salinity profile, may cause the code to fail
upon restart. Therefore, new model configurations may need to be started
using <cite>runtype</cite> = ‘initial’. Binary restart files that were provided with
CICE v4.1 were made using the BL99 thermodynamics with 4 layers and 5
thickness categories (<cite>kcatbound</cite> = 0) and therefore can not be used for
the default CICE v5 configuration (7 layers). In addition, CICE’s
default restart file format is now &nbsp;instead of binary.</p>
<p>Restarting a run using <cite>runtype</cite> = ‘continue’ requires restart data for
all tracers used in the new run. If tracer restart data is not
available, use <cite>runtype</cite> = ‘initial’, setting <cite>ice_ic</cite> to the name of the
core restart file and setting to true the namelist restart flags for
each tracer that is available. The unavailable tracers will be
initialized to their default settings.</p>
<p>On tripole grids, use <cite>restart_ext</cite> = true when using either binary or
regular (non-PIO) netcdf.</p>
<p>Provided that the same number of ice layers (default: 4) will be used
for the new runs, it is possible to convert v4.1 restart files to the
new file structure and then to &nbsp;format. If the same physical
parameterizations are used, the code should be able to execute from
these files. However if different physics is used (for instance, mushy
thermo instead of BL99), the code may still fail. To convert a v4.1
restart file:</p>
<ol class="arabic simple">
<li>Edit the code <strong>input_templates/convert_restarts.f90</strong> for your
model configuration and path names. Compile and run this code to
create a binary restart file that can be read using v5. Copy the
resulting file to the <strong>restart/</strong> subdirectory in your working
directory.</li>
<li>In your working directory, turn off all tracer restart flags in
<strong>ice_in</strong> and set the following:<ul>
<li>runtype = ‘initial’</li>
<li>ice_ic = ‘./restart/[your binary file name]’</li>
<li>restart = .true.</li>
<li>use_restart_time = .true.</li>
</ul>
</li>
<li>In <strong>CICE_InitMod.F90</strong>, comment out the call to
restartfile(ice_ic) and uncomment the call to
restartfile_v4(ice_ic) immediately below it. This will read the
v4.1 binary file and write a v5 &nbsp;file containing the same
information.</li>
</ol>
<p>If restart files are taking a long time to be written serially (i.e.,
not using PIO), see the next section.</p>
</div>
<div class="section" id="slow-execution">
<h2>5.3. Slow execution<a class="headerlink" href="#slow-execution" title="Permalink to this headline">¶</a></h2>
<p>On some architectures, underflows (<span class="math">10^{-300}</span> for example) are
not flushed to zero automatically. Usually a compiler flag is available
to do this, but if not, try uncommenting the block of code at the end of
subroutine <em>stress</em> in <strong>ice_dyn_evp.F90</strong> or <strong>ice_dyn_eap.F90</strong>.
You will take a hit for the extra computations, but it will not be as
bad as running with the underflows.</p>
<p>In some configurations, multiple calls to scatter or gather global
variables may overfill MPI’s buffers, causing the code to slow down
(particularly when writing large output files such as restarts). To
remedy this problem, set <cite>BARRIERS yes</cite> in <strong>comp_ice</strong>. This
synchronizes MPI messages, keeping the buffers in check.</p>
</div>
<div class="section" id="debugging-hints">
<h2>5.4. Debugging hints<a class="headerlink" href="#debugging-hints" title="Permalink to this headline">¶</a></h2>
<p>Several utilities are available that can be helpful when debugging the
code. Not all of these will work everywhere in the code, due to possible
conflicts in module dependencies.</p>
<dl class="docutils">
<dt><em>debug_ice</em> (<strong>CICE.F90</strong>)</dt>
<dd>A wrapper for <em>print_state</em> that is easily called from numerous
points during the timestepping loop (see
<strong>CICE_RunMod.F90_debug</strong>, which can be substituted for
<strong>CICE_RunMod.F90</strong>).</dd>
<dt><em>print_state</em> (<strong>ice_diagnostics.F90</strong>)</dt>
<dd>Print the ice state and forcing fields for a given grid cell.</dd>
<dt><cite>dbug</cite> = true (<strong>ice_in</strong>)</dt>
<dd>Print numerous diagnostic quantities.</dd>
<dt><cite>print_global</cite> (<strong>ice_in</strong>)</dt>
<dd>If true, compute and print numerous global sums for energy and mass
balance analysis. This option can significantly degrade code
efficiency.</dd>
<dt><cite>print_points</cite> (<strong>ice_in</strong>)</dt>
<dd>If true, print numerous diagnostic quantities for two grid cells,
one near the north pole and one in the Weddell Sea. This utility
also provides the local grid indices and block and processor numbers
(<cite>ip</cite>, <cite>jp</cite>, <cite>iblkp</cite>, <cite>mtask</cite>) for these points, which can be used in
conjunction with <cite>check_step</cite>, to call <em>print_state</em>. These flags
are set in <strong>ice_diagnostics.F90</strong>. This option can be fairly slow,
due to gathering data from processors.</dd>
<dt><em>global_minval, global_maxval, global_sum</em> (<strong>ice_global_reductions.F90</strong>)</dt>
<dd>Compute and print the minimum and maximum values for an individual
real array, or its global sum.</dd>
</dl>
</div>
<div class="section" id="known-bugs">
<h2>5.5. Known bugs<a class="headerlink" href="#known-bugs" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Fluxes sent to the CESM coupler may have incorrect values in grid
cells that change from an ice-free state to having ice during the
given time step, or vice versa, due to scaling by the ice area. The
authors of the CESM flux coupler insist on the area scaling so that
the ice and land models are treated consistently in the coupler (but
note that the land area does not suddenly become zero in a grid cell,
as does the ice area).</li>
<li>With the old CCSM radiative scheme (<cite>shortwave</cite> = ‘default’ or
‘ccsm3’), a sizable fraction (more than 10%) of the total shortwave
radiation is absorbed at the surface but should be penetrating into
the ice interior instead. This is due to use of the aggregated,
effective albedo rather than the bare ice albedo when
<cite>snowpatch</cite>&nbsp;<span class="math">< 1</span>.</li>
<li>The date-of-onset diagnostic variables, <cite>melt_onset</cite> and <cite>frz_onset</cite>,
are not included in the core restart file, and therefore may be
incorrect for the current year if the run is restarted after Jan 1.
Also, these variables were implemented with the Arctic in mind and
may be incorrect for the Antarctic.</li>
<li>The single-processor <em>system_clock</em> time may give erratic results on
some architectures.</li>
<li>History files that contain time averaged data (<cite>hist_avg</cite> = true in
<strong>ice_in</strong>) will be incorrect if restarting from midway through an
averaging period.</li>
<li>In stand-alone runs, restarts from the end of <cite>ycycle</cite> will not be
exact.</li>
<li>Using the same frequency twice in <cite>histfreq</cite> will have unexpected
consequences and causes the code to abort.</li>
<li>Latitude and longitude fields in the history output may be wrong when
using padding.</li>
</ol>
</div>
<div class="section" id="interpretation-of-albedos">
<h2>5.6. Interpretation of albedos<a class="headerlink" href="#interpretation-of-albedos" title="Permalink to this headline">¶</a></h2>
<p>The snow-and-ice albedo, <cite>albsni</cite>, and diagnostic albedos <cite>albice</cite>, <cite>albsno</cite>,
and <cite>albpnd</cite> are merged over categories but not scaled (divided) by the
total ice area. (This is a change from CICE v4.1 for <cite>albsni</cite>.) The latter
three history variables represent completely bare or completely snow- or
melt-pond-covered ice; that is, they do not take into account the snow
or melt pond fraction (<cite>albsni</cite> does, as does the code itself during
thermodyamic computations). This is to facilitate comparison with
typical values in measurements or other albedo parameterizations. The
melt pond albedo <cite>albpnd</cite> is only computed for the Delta-Eddington
shortwave case.</p>
<p>With the Delta-Eddington parameterization, the albedo depends on the
cosine of the zenith angle (<span class="math">\cos\varphi</span>, <cite>coszen</cite>) and is zero if
the sun is below the horizon (<span class="math">\cos\varphi < 0</span>). Therefore
time-averaged albedo fields would be low if a diurnal solar cycle is
used, because zero values would be included in the average for half of
each 24-hour period. To rectify this, a separate counter is used for the
averaging that is incremented only when <span class="math">\cos\varphi > 0</span>. The
albedos will still be zero in the dark, polar winter hemisphere.</p>
</div>
<div class="section" id="proliferating-subprocess-parameterizations">
<h2>5.7. Proliferating subprocess parameterizations<a class="headerlink" href="#proliferating-subprocess-parameterizations" title="Permalink to this headline">¶</a></h2>
<p>With the addition of several alternative parameterizations for sea ice
processes, a number of subprocesses now appear in multiple parts of the
code with differing descriptions. For instance, sea ice porosity and
permeability, along with associated flushing and flooding, are
calculated separately for mushy thermodynamics, topo and level-ice melt
ponds, and for the brine height tracer, each employing its own
equations. Likewise, the BL99 and mushy thermodynamics compute freeboard
and snow–ice formation differently, and the topo and level-ice melt pond
schemes both allow fresh ice to grow atop melt ponds, using slightly
different formulations for Stefan freezing. These various process
parameterizations will be compared and their subprocess descriptions
possibly unified in the future.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cice_6_copyright.html" title="6. Acknowledgments and Copyright"
             >next</a></li>
        <li class="right" >
          <a href="cice_4_numerical_implementation.html" title="4. Numerical implementation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Los Alamos National Security, LLC (code) and National Center for Atmospheric Research (documentation).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>