<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7. Testing CICE &#8212; CICE-Consortium 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Acknowledgments and Copyright" href="cice_8_copyright.html" />
    <link rel="prev" title="6. Troubleshooting" href="cice_6_troubleshooting.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cice_8_copyright.html" title="8. Acknowledgments and Copyright"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="cice_6_troubleshooting.html" title="6. Troubleshooting"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing-cice">
<h1>7. Testing CICE<a class="headerlink" href="#testing-cice" title="Permalink to this headline">¶</a></h1>
<p>Version 6, August 2017
This documents how to use the testing features developed for the
CICE Consortium CICE sea ice model.</p>
<div class="section" id="individual-tests-and-test-suites">
<span id="basic"></span><h2>7.1. Individual tests and test suites<a class="headerlink" href="#individual-tests-and-test-suites" title="Permalink to this headline">¶</a></h2>
<p>The CICE scripts support both setup of individual tests as well as test suites.  Individual
tests are run from the command line like</p>
<blockquote>
<div>&gt; create.case -t smoke -m wolf -g gx3 -p 8x2 -s diag1,run5day -testid myid</div></blockquote>
<p>where -m designates a specific machine.  Test suites are multiple tests that are specified in
an input file and are started on the command line like</p>
<blockquote>
<div>&gt; create.case -ts base_suite -m wolf -testid myid</div></blockquote>
<p>create.case with -t or -ts require a testid to uniquely name test directories.  The format
of the case directory name for a test will always be
${machine}_${test}_${grid}_${pes}_${soptions}.${testid}</p>
<dl class="docutils">
<dt>To build and run a test, the process is the same as a case,</dt>
<dd><p class="first">cd into the test directory,</p>
<p>run cice.build</p>
<p class="last">run cice.submit</p>
</dd>
</dl>
<p>The test results will be generated in a local file called &#8220;test_output&#8221;.</p>
<p>When running a test suite, the create.case command line automatically generates all the tests
under a directory names ${test_suite}.${testid}.  It then automatically builds and submits all
tests.  When the tests are complete, run the results.csh script to see the results from all the
tests.</p>
<dl class="docutils">
<dt>Tests are defined under configuration/scripts/tests.  The tests currently supported are:</dt>
<dd><dl class="first last docutils">
<dt>smoke   - Runs the model for default length.  The length and options can</dt>
<dd>be set with the -s commmand line option.  The test passes if the
model completes successfully.</dd>
<dt>restart - Runs the model for 10 days, writing a restart file at day 5 and</dt>
<dd>again at day 10.  Runs the model a second time starting from the
day 5 restart and writing a restart at day 10 of the model run.
The test passes if both the 10 day and 5 day restart run complete and
if the restart files at day 10 from both runs are bit-for-bit identical.</dd>
</dl>
</dd>
</dl>
<p>Please run &#8216;./create.case -h&#8217; for additional details.</p>
</div>
<div class="section" id="additional-testing-options">
<span id="additional"></span><h2>7.2. Additional testing options<a class="headerlink" href="#additional-testing-options" title="Permalink to this headline">¶</a></h2>
<p>There are several additional options on the create.case command line for testing that
provide the ability to regression test and compare tests to each other.</p>
<blockquote>
<div><p>-bd defines a baseline directory where tests can be stored for regression testing</p>
<p>-bg defines a version name that where the current tests can be saved for regression testing</p>
<p>-bc defines a version name that the current tests should be compared to for regression testing</p>
<p>-td provides a way to compare tests with each other</p>
</div></blockquote>
<dl class="docutils">
<dt>To use -bg,</dt>
<dd>&gt; create.case -ts base_suite -m wolf -testid v1 -bg version1 -bd $SCRATCH/CICE_BASELINES</dd>
</dl>
<p>will copy all the results from the test suite to $SCRATCH/CICE_BASELINES/version1.</p>
<dl class="docutils">
<dt>To use -bc,</dt>
<dd>&gt; create.case -ts base_suite -m wolf -testid v2 -bc version1 -bd $SCRATCH/CICE_BASELINES</dd>
</dl>
<p>will compare all the results from this test suite to results saved before in $SCRATCH/CICE_BASELINES/version1.</p>
<dl class="docutils">
<dt>-bc and -bg can be combined,</dt>
<dd>&gt;create.case -ts base_suite -m wolf -testid v2 -bg version2 -bc version1 -bd $SCRATCH/CICE_BASELINES</dd>
</dl>
<p>will save the current results to $SCRATCH/CICE_BASELINES/version2 and compare the current results to
results save before in $SCRATCH/CICE_BASELINES/version1.</p>
<p>-bg, -bc, and -bd are used for regression testing.  There is a default -bd on each machine.</p>
<dl class="docutils">
<dt>-td allows a user to compare one test result to another.  For instance,</dt>
<dd>&gt; create.case -t smoke -m wolf -g gx3 -p 8x2 -s run5day -testid t01
&gt; create.case -t smoke -m wolf -g gx3 -p 4x2 -s run5day -testid t01 -td smoke_gx3_8x2_run5day</dd>
</dl>
<p>An additional check will be done for the second test (because of the -td argument), and it will compare
the output from the first test &#8220;smoke_gx3_8x2_run5day&#8221; to the output from it&#8217;s test &#8220;smoke_gx3_4x2_run5day&#8221;
and generate a result for that.  It&#8217;s important that the first test complete before the second test is
done.  Also, the -td option works only if the testid and the machine are the same for the baseline
run and the current run.</p>
</div>
<div class="section" id="test-suite-format">
<span id="format"></span><h2>7.3. Test suite format<a class="headerlink" href="#test-suite-format" title="Permalink to this headline">¶</a></h2>
<p>The format for the test suite file is relatively simple.  It is a text file with white space delimited
columns like,</p>
<table border="1" class="colwidths-given docutils" id="id5">
<span id="tab-test"></span><caption><span class="caption-text">Table 7</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="29%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">#Test</th>
<th class="head">Grid</th>
<th class="head">PEs</th>
<th class="head">Sets</th>
<th class="head">BFB-compare</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>smoke</td>
<td>gx3</td>
<td>8x2</td>
<td>diag1,run5day</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>smoke</td>
<td>gx3</td>
<td>8x2</td>
<td>diag24,run1year,medium</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>smoke</td>
<td>gx3</td>
<td>4x1</td>
<td>debug,diag1,run5day</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>smoke</td>
<td>gx3</td>
<td>8x2</td>
<td>debug,diag1,run5day</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>smoke</td>
<td>gx3</td>
<td>4x2</td>
<td>diag1,run5day</td>
<td>smoke_gx3_8x2_diag1_run5day</td>
</tr>
<tr class="row-odd"><td>smoke</td>
<td>gx3</td>
<td>4x1</td>
<td>diag1,run5day,thread</td>
<td>smoke_gx3_8x2_diag1_run5day</td>
</tr>
<tr class="row-even"><td>smoke</td>
<td>gx3</td>
<td>4x1</td>
<td>diag1,run5day</td>
<td>smoke_gx3_4x1_diag1_run5day_thread</td>
</tr>
<tr class="row-odd"><td>restart</td>
<td>gx3</td>
<td>8x1</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>restart</td>
<td>gx3</td>
<td>4x2</td>
<td>debug</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>The first column is the test name, the second the grid, the third the pe count, the fourth column is
the -s options and the fifth column is the -td argument.  The fourth and fifth columns are optional.
The argument to -ts defines which filename to choose and that argument can contain a path.  create.case
will also look for the filename in configuration/scripts/tests where some preset test suites are defined.</p>
</div>
<div class="section" id="example-tests-quickstart">
<h2>7.4. Example Tests (Quickstart)<a class="headerlink" href="#example-tests-quickstart" title="Permalink to this headline">¶</a></h2>
<div class="section" id="to-generate-a-baseline-dataset-for-a-test-case">
<h3>7.4.1. To generate a baseline dataset for a test case<a class="headerlink" href="#to-generate-a-baseline-dataset-for-a-test-case" title="Permalink to this headline">¶</a></h3>
<p>./create.case -t smoke -m wolf -bg cicev6.0.0 -testid t00</p>
<p>cd wolf_smoke_gx3_4x1.t00</p>
<p>./cice.build</p>
<p>./cice.submit</p>
<p># After job finishes, check output</p>
<p>cat test_output</p>
</div>
<div class="section" id="to-run-a-test-case-and-compare-to-a-baseline-dataset">
<h3>7.4.2. To run a test case and compare to a baseline dataset<a class="headerlink" href="#to-run-a-test-case-and-compare-to-a-baseline-dataset" title="Permalink to this headline">¶</a></h3>
<p>./create.case -t smoke -m wolf -bc cicev6.0.0 -testid t01</p>
<p>cd wolf_smoke_gx3_4x1.t01</p>
<p>./cice.build</p>
<p>./cice.submit</p>
<p># After job finishes, check output</p>
<p>cat test_output</p>
</div>
<div class="section" id="to-run-a-test-suite-to-generate-baseline-data">
<h3>7.4.3. To run a test suite to generate baseline data<a class="headerlink" href="#to-run-a-test-suite-to-generate-baseline-data" title="Permalink to this headline">¶</a></h3>
<p>./create.case -m wolf -ts base_suite -testid t02 -bg cicev6.0.0bs</p>
<p>cd base_suite.t02</p>
<p># Once all jobs finish, concatenate all output</p>
<p>./results.csh  # All tests results will be stored in results.log</p>
<p># To plot a timeseries of &#8220;total ice extent&#8221;, &#8220;total ice area&#8221;, and &#8220;total ice volume&#8221;</p>
<p>./timeseries.csh &lt;directory&gt;</p>
<p>ls <a href="#id1"><span class="problematic" id="id2">*</span></a>.png</p>
</div>
<div class="section" id="to-run-a-test-suite-to-compare-to-baseline-data">
<h3>7.4.4. To run a test suite to compare to baseline data<a class="headerlink" href="#to-run-a-test-suite-to-compare-to-baseline-data" title="Permalink to this headline">¶</a></h3>
<p>./create.case -m wolf -ts base_suite -testid t03 -bc cicev6.0.0bs</p>
<p>cd base_suite.t03</p>
<p># Once all jobs finish, concatenate all output</p>
<p>./results.csh  # All tests results will be stored in results.log</p>
<p># To plot a timeseries of &#8220;total ice extent&#8221;, &#8220;total ice area&#8221;, and &#8220;total ice volume&#8221;</p>
<p>./timeseries.csh &lt;directory&gt;</p>
<p>ls <a href="#id3"><span class="problematic" id="id4">*</span></a>.png</p>
</div>
<div class="section" id="to-compare-to-another-test">
<h3>7.4.5. To compare to another test<a class="headerlink" href="#to-compare-to-another-test" title="Permalink to this headline">¶</a></h3>
<p><cite>First:</cite></p>
<p>./create.case -m wolf -t smoke -testid t01 -p 8x2</p>
<p>cd wolf_smoke_gx3_8x2.t01</p>
<p>./cice.build</p>
<p>./cice.submit</p>
<p># After job finishes, check output</p>
<p>cat test_output</p>
<p><cite>Then, do the comparison:</cite></p>
<p>./create.case -m wolf -t smoke -testid t01 -td smoke_gx3_8x2 -s thread -p 4x1</p>
<p>cd wolf_smoke_gx3_4x1_thread.t01</p>
<p>./cice.build</p>
<p>./cice.submit</p>
<p># After job finishes, check output</p>
<p>cat test_output</p>
</div>
</div>
<div class="section" id="additional-details">
<h2>7.5. Additional Details<a class="headerlink" href="#additional-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>In general, the baseline generation, baseline compare, and test diff are independent.</li>
<li><dl class="first docutils">
<dt>Use the &#8216;-bd&#8217; flag to specify the location where you want the baseline dataset</dt>
<dd>to be written.  Without specifying &#8216;-bd&#8217;, the baseline dataset will be written
to the default baseline directory found in the env.&lt;machine&gt; file (ICE_MACHINE_BASELINE).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If &#8216;-bd&#8217; is not passed, the scripts will look for baseline datasets in the default</dt>
<dd>baseline directory found in the env.&lt;machine&gt; file (ICE_MACHINE_BASELINE).
If the &#8216;-bd&#8217; option is passed, the scripts will look for baseline datasets in the
location passed to the -bd argument.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To generate a baseline dataset for a specific version (for regression testing),</dt>
<dd>use &#8216;-bg &lt;version_name&gt;&#8217;.  The scripts will then place the baseline dataset
in $ICE_MACHINE_BASELINE/&lt;version_name&gt;/</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The &#8216;-testid&#8217; flag allows users to specify a testing id that will be added to the</dt>
<dd>end of the case directory.  For example, &#8221;./create.case -m wolf -t smoke -testid t12 -p 4x1&#8221;
creates the directory wolf_smoke_gx3_4x1.t12.  This flag is REQUIRED if using -t or -ts.</dd>
</dl>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7. Testing CICE</a><ul>
<li><a class="reference internal" href="#individual-tests-and-test-suites">7.1. Individual tests and test suites</a></li>
<li><a class="reference internal" href="#additional-testing-options">7.2. Additional testing options</a></li>
<li><a class="reference internal" href="#test-suite-format">7.3. Test suite format</a></li>
<li><a class="reference internal" href="#example-tests-quickstart">7.4. Example Tests (Quickstart)</a><ul>
<li><a class="reference internal" href="#to-generate-a-baseline-dataset-for-a-test-case">7.4.1. To generate a baseline dataset for a test case</a></li>
<li><a class="reference internal" href="#to-run-a-test-case-and-compare-to-a-baseline-dataset">7.4.2. To run a test case and compare to a baseline dataset</a></li>
<li><a class="reference internal" href="#to-run-a-test-suite-to-generate-baseline-data">7.4.3. To run a test suite to generate baseline data</a></li>
<li><a class="reference internal" href="#to-run-a-test-suite-to-compare-to-baseline-data">7.4.4. To run a test suite to compare to baseline data</a></li>
<li><a class="reference internal" href="#to-compare-to-another-test">7.4.5. To compare to another test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-details">7.5. Additional Details</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cice_6_troubleshooting.html"
                        title="previous chapter">6. Troubleshooting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cice_8_copyright.html"
                        title="next chapter">8. Acknowledgments and Copyright</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cice_7_testing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cice_8_copyright.html" title="8. Acknowledgments and Copyright"
             >next</a></li>
        <li class="right" >
          <a href="cice_6_troubleshooting.html" title="6. Troubleshooting"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CICE-Consortium 0.0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Los Alamos National Security, LLC (code) and National Center for Atmospheric Research (documentation).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>